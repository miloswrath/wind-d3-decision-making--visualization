(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Cn(t){return t=t.split("#")[0].split("?")[0],t=t.replace(/index\.html$/i,"").replace(/\/+$/,""),t||"/"}function An(t){const e=[];t=Cn(t);const n=t.replace(/:[^/]+/g,i=>(e.push(i.slice(1)),"([^/]+)"));return{re:new RegExp(`^${n}$`),keys:e}}class $n{constructor(e){this.routes=[],this.base=(document.querySelector("base")?.getAttribute("href")||"/").replace(/\/+$/,""),this.navigate=n=>{const r=new URL(n,location.origin),i=`${r.pathname}${r.search}${r.hash}`,o=`${location.pathname}${location.search}${location.hash}`;i!==o&&(history.pushState({},"",i),this.handle(r))},this.outlet=e.outlet,this.routes=e.routes.map(n=>({cfg:n,...An(n.path)})),window.addEventListener("popstate",()=>this.handle(new URL(location.href))),document.addEventListener("click",n=>{const r=n.target.closest("a[data-link]");r&&r.origin===location.origin&&(n.preventDefault(),this.navigate(r.pathname))}),this.handle(new URL(location.href))}async handle(e){const n=e instanceof URL?e:new URL(e,location.origin),r=n.pathname.replace(/\/+$/,"")||"/";for(const i of this.routes){const o=r.match(i.re);if(!o)continue;const s=Object.fromEntries(i.keys.map((a,c)=>[a,decodeURIComponent(o[c+1])]));document.title=i.cfg.title??"Decision Layout",this.outlet.replaceChildren(),await i.cfg.render(this.outlet,{params:s,query:new URLSearchParams(n.searchParams),navigate:this.navigate}),window.scrollTo({top:0});return}this.outlet.innerHTML=`<div class="card"><h1 class="h1">Not Found</h1><p>No route for <code>${r}</code></p></div>`}}const Ae=(t,{navigate:e})=>{t.innerHTML=`
    <section class="card">
      <h1 class="h1">Decision Maker V1</h1>
      <p>This tool helps people make decisions when there are many options, many factors to consider, and they all matter to different extents for every individual. One example might be how to choose which apartment is best for you from several options, but this can apply to almost any tough decision.</p>
      <p>There are three main stages to build your layout.</p>
      <p>1. You specify your different options</p>
      <p>2. You determine what factors to consider and which are the most important to you.</p>
      <p>3. Use the built layout to guide your decision.</p>
      <button id="go" style="padding:.5rem .8rem;border-radius:.5rem;border:none;background:var(--accent);color:white">Open Builder</button>
    </section>`,t.querySelector("#go").onclick=()=>e("/builder")};var fe="http://www.w3.org/1999/xhtml";const $e={svg:"http://www.w3.org/2000/svg",xhtml:fe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function re(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),$e.hasOwnProperty(e)?{space:$e[e],local:t}:t}function Mn(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===fe&&e.documentElement.namespaceURI===fe?e.createElement(t):e.createElementNS(n,t)}}function Nn(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ke(t){var e=re(t);return(e.local?Nn:Mn)(e)}function kn(){}function ve(t){return t==null?kn:function(){return this.querySelector(t)}}function Tn(t){typeof t!="function"&&(t=ve(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),c,l,u=0;u<s;++u)(c=o[u])&&(l=t.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new K(r,this._parents)}function Dn(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ln(){return[]}function Je(t){return t==null?Ln:function(){return this.querySelectorAll(t)}}function Rn(t){return function(){return Dn(t.apply(this,arguments))}}function On(t){typeof t=="function"?t=Rn(t):t=Je(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&(r.push(t.call(c,c.__data__,l,s)),i.push(c));return new K(r,i)}function Qe(t){return function(){return this.matches(t)}}function Ze(t){return function(e){return e.matches(t)}}var Wn=Array.prototype.find;function Un(t){return function(){return Wn.call(this.children,t)}}function Fn(){return this.firstElementChild}function Hn(t){return this.select(t==null?Fn:Un(typeof t=="function"?t:Ze(t)))}var Pn=Array.prototype.filter;function zn(){return Array.from(this.children)}function qn(t){return function(){return Pn.call(this.children,t)}}function Bn(t){return this.selectAll(t==null?zn:qn(typeof t=="function"?t:Ze(t)))}function Xn(t){typeof t!="function"&&(t=Qe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new K(r,this._parents)}function je(t){return new Array(t.length)}function Yn(){return new K(this._enter||this._groups.map(je),this._parents)}function Qt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Qt.prototype={constructor:Qt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Vn(t){return function(){return t}}function Gn(t,e,n,r,i,o){for(var s=0,a,c=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new Qt(t,o[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function Kn(t,e,n,r,i,o,s){var a,c,l=new Map,u=e.length,g=o.length,p=new Array(u),w;for(a=0;a<u;++a)(c=e[a])&&(p[a]=w=s.call(c,c.__data__,a,e)+"",l.has(w)?i[a]=c:l.set(w,c));for(a=0;a<g;++a)w=s.call(t,o[a],a,o)+"",(c=l.get(w))?(r[a]=c,c.__data__=o[a],l.delete(w)):n[a]=new Qt(t,o[a]);for(a=0;a<u;++a)(c=e[a])&&l.get(p[a])===c&&(i[a]=c)}function Jn(t){return t.__data__}function Qn(t,e){if(!arguments.length)return Array.from(this,Jn);var n=e?Kn:Gn,r=this._parents,i=this._groups;typeof t!="function"&&(t=Vn(t));for(var o=i.length,s=new Array(o),a=new Array(o),c=new Array(o),l=0;l<o;++l){var u=r[l],g=i[l],p=g.length,w=Zn(t.call(u,u&&u.__data__,l,r)),k=w.length,D=a[l]=new Array(k),z=s[l]=new Array(k),ut=c[l]=new Array(p);n(u,g,D,z,ut,w,e);for(var Y=0,G=0,f,$;Y<k;++Y)if(f=D[Y]){for(Y>=G&&(G=Y+1);!($=z[G])&&++G<k;);f._next=$||null}}return s=new K(s,r),s._enter=a,s._exit=c,s}function Zn(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function jn(){return new K(this._exit||this._groups.map(je),this._parents)}function tr(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function er(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),c=0;c<s;++c)for(var l=n[c],u=r[c],g=l.length,p=a[c]=new Array(g),w,k=0;k<g;++k)(w=l[k]||u[k])&&(p[k]=w);for(;c<i;++c)a[c]=n[c];return new K(a,this._parents)}function nr(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function rr(t){t||(t=ir);function e(g,p){return g&&p?t(g.__data__,p.__data__):!g-!p}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,c=i[o]=new Array(a),l,u=0;u<a;++u)(l=s[u])&&(c[u]=l);c.sort(e)}return new K(i,this._parents).order()}function ir(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function or(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function sr(){return Array.from(this)}function ar(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function cr(){let t=0;for(const e of this)++t;return t}function lr(){return!this.node()}function ur(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function hr(t){return function(){this.removeAttribute(t)}}function fr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function dr(t,e){return function(){this.setAttribute(t,e)}}function pr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function gr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function mr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function yr(t,e){var n=re(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?fr:hr:typeof e=="function"?n.local?mr:gr:n.local?pr:dr)(n,e))}function tn(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function wr(t){return function(){this.style.removeProperty(t)}}function xr(t,e,n){return function(){this.style.setProperty(t,e,n)}}function vr(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function _r(t,e,n){return arguments.length>1?this.each((e==null?wr:typeof e=="function"?vr:xr)(t,e,n??"")):St(this.node(),t)}function St(t,e){return t.style.getPropertyValue(e)||tn(t).getComputedStyle(t,null).getPropertyValue(e)}function br(t){return function(){delete this[t]}}function Ir(t,e){return function(){this[t]=e}}function Er(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Sr(t,e){return arguments.length>1?this.each((e==null?br:typeof e=="function"?Er:Ir)(t,e)):this.node()[t]}function en(t){return t.trim().split(/^|\s+/)}function _e(t){return t.classList||new nn(t)}function nn(t){this._node=t,this._names=en(t.getAttribute("class")||"")}nn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function rn(t,e){for(var n=_e(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function on(t,e){for(var n=_e(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Cr(t){return function(){rn(this,t)}}function Ar(t){return function(){on(this,t)}}function $r(t,e){return function(){(e.apply(this,arguments)?rn:on)(this,t)}}function Mr(t,e){var n=en(t+"");if(arguments.length<2){for(var r=_e(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?$r:e?Cr:Ar)(n,e))}function Nr(){this.textContent=""}function kr(t){return function(){this.textContent=t}}function Tr(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Dr(t){return arguments.length?this.each(t==null?Nr:(typeof t=="function"?Tr:kr)(t)):this.node().textContent}function Lr(){this.innerHTML=""}function Rr(t){return function(){this.innerHTML=t}}function Or(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Wr(t){return arguments.length?this.each(t==null?Lr:(typeof t=="function"?Or:Rr)(t)):this.node().innerHTML}function Ur(){this.nextSibling&&this.parentNode.appendChild(this)}function Fr(){return this.each(Ur)}function Hr(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Pr(){return this.each(Hr)}function zr(t){var e=typeof t=="function"?t:Ke(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function qr(){return null}function Br(t,e){var n=typeof t=="function"?t:Ke(t),r=e==null?qr:typeof e=="function"?e:ve(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Xr(){var t=this.parentNode;t&&t.removeChild(this)}function Yr(){return this.each(Xr)}function Vr(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Gr(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Kr(t){return this.select(t?Gr:Vr)}function Jr(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Qr(t){return function(e){t.call(this,e,this.__data__)}}function Zr(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function jr(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function ti(t,e,n){return function(){var r=this.__on,i,o=Qr(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ei(t,e,n){var r=Zr(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(i=0,u=a[c];i<o;++i)if((s=r[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?ti:jr,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function sn(t,e,n){var r=tn(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ni(t,e){return function(){return sn(this,t,e)}}function ri(t,e){return function(){return sn(this,t,e.apply(this,arguments))}}function ii(t,e){return this.each((typeof e=="function"?ri:ni)(t,e))}function*oi(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var an=[null];function K(t,e){this._groups=t,this._parents=e}function At(){return new K([[document.documentElement]],an)}function si(){return this}K.prototype=At.prototype={constructor:K,select:Tn,selectAll:On,selectChild:Hn,selectChildren:Bn,filter:Xn,data:Qn,enter:Yn,exit:jn,join:tr,merge:er,selection:si,order:nr,sort:rr,call:or,nodes:sr,node:ar,size:cr,empty:lr,each:ur,attr:yr,style:_r,property:Sr,classed:Mr,text:Dr,html:Wr,raise:Fr,lower:Pr,append:zr,insert:Br,remove:Yr,clone:Kr,datum:Jr,on:ei,dispatch:ii,[Symbol.iterator]:oi};function tt(t){return typeof t=="string"?new K([[document.querySelector(t)]],[document.documentElement]):new K([[t]],an)}function ai(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Me(t,e){if(t=ai(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function Ne(t,e){let n=0;for(let r of t)(r=+r)&&(n+=r);return n}var ci={value:()=>{}};function be(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Gt(n)}function Gt(t){this._=t}function li(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Gt.prototype=be.prototype={constructor:Gt,on:function(t,e){var n=this._,r=li(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=ui(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=ke(n[i],t.name,e);else if(e==null)for(i in n)n[i]=ke(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Gt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function ui(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function ke(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=ci,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}const hi={passive:!1},Lt={capture:!0,passive:!1};function le(t){t.stopImmediatePropagation()}function It(t){t.preventDefault(),t.stopImmediatePropagation()}function fi(t){var e=t.document.documentElement,n=tt(t).on("dragstart.drag",It,Lt);"onselectstart"in e?n.on("selectstart.drag",It,Lt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function di(t,e){var n=t.document.documentElement,r=tt(t).on("dragstart.drag",null);e&&(r.on("click.drag",It,Lt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const qt=t=>()=>t;function de(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:s,y:a,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}de.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function pi(t){return!t.ctrlKey&&!t.button}function gi(){return this.parentNode}function mi(t,e){return e??{x:t.x,y:t.y}}function yi(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mt(){var t=pi,e=gi,n=mi,r=yi,i={},o=be("start","drag","end"),s=0,a,c,l,u,g=0;function p(f){f.on("mousedown.drag",w).filter(r).on("touchstart.drag",z).on("touchmove.drag",ut,hi).on("touchend.drag touchcancel.drag",Y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function w(f,$){if(!(u||!t.call(this,f,$))){var T=G(this,e.call(this,f,$),f,$,"mouse");T&&(tt(f.view).on("mousemove.drag",k,Lt).on("mouseup.drag",D,Lt),fi(f.view),le(f),l=!1,a=f.clientX,c=f.clientY,T("start",f))}}function k(f){if(It(f),!l){var $=f.clientX-a,T=f.clientY-c;l=$*$+T*T>g}i.mouse("drag",f)}function D(f){tt(f.view).on("mousemove.drag mouseup.drag",null),di(f.view,l),It(f),i.mouse("end",f)}function z(f,$){if(t.call(this,f,$)){var T=f.changedTouches,S=e.call(this,f,$),q=T.length,O,Z;for(O=0;O<q;++O)(Z=G(this,S,f,$,T[O].identifier,T[O]))&&(le(f),Z("start",f,T[O]))}}function ut(f){var $=f.changedTouches,T=$.length,S,q;for(S=0;S<T;++S)(q=i[$[S].identifier])&&(It(f),q("drag",f,$[S]))}function Y(f){var $=f.changedTouches,T=$.length,S,q;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),S=0;S<T;++S)(q=i[$[S].identifier])&&(le(f),q("end",f,$[S]))}function G(f,$,T,S,q,O){var Z=o.copy(),B=Me(O||T,$),yt,st,J;if((J=n.call(f,new de("beforestart",{sourceEvent:T,target:p,identifier:q,active:s,x:B[0],y:B[1],dx:0,dy:0,dispatch:Z}),S))!=null)return yt=J.x-B[0]||0,st=J.y-B[1]||0,function P(wt,L,xt){var m=B,_;switch(wt){case"start":i[q]=P,_=s++;break;case"end":delete i[q],--s;case"drag":B=Me(xt||L,$),_=s;break}Z.call(wt,f,new de(wt,{sourceEvent:L,subject:J,target:p,identifier:q,active:_,x:B[0]+yt,y:B[1]+st,dx:B[0]-m[0],dy:B[1]-m[1],dispatch:Z}),S)}}return p.filter=function(f){return arguments.length?(t=typeof f=="function"?f:qt(!!f),p):t},p.container=function(f){return arguments.length?(e=typeof f=="function"?f:qt(f),p):e},p.subject=function(f){return arguments.length?(n=typeof f=="function"?f:qt(f),p):n},p.touchable=function(f){return arguments.length?(r=typeof f=="function"?f:qt(!!f),p):r},p.on=function(){var f=o.on.apply(o,arguments);return f===o?p:f},p.clickDistance=function(f){return arguments.length?(g=(f=+f)*f,p):Math.sqrt(g)},p}function Ie(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function cn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ft(){}var Rt=.7,Zt=1/Rt,Et="\\s*([+-]?\\d+)\\s*",Ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",it="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wi=/^#([0-9a-f]{3,8})$/,xi=new RegExp(`^rgb\\(${Et},${Et},${Et}\\)$`),vi=new RegExp(`^rgb\\(${it},${it},${it}\\)$`),_i=new RegExp(`^rgba\\(${Et},${Et},${Et},${Ot}\\)$`),bi=new RegExp(`^rgba\\(${it},${it},${it},${Ot}\\)$`),Ii=new RegExp(`^hsl\\(${Ot},${it},${it}\\)$`),Ei=new RegExp(`^hsla\\(${Ot},${it},${it},${Ot}\\)$`),Te={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ie(Ft,Wt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:De,formatHex:De,formatHex8:Si,formatHsl:Ci,formatRgb:Le,toString:Le});function De(){return this.rgb().formatHex()}function Si(){return this.rgb().formatHex8()}function Ci(){return ln(this).formatHsl()}function Le(){return this.rgb().formatRgb()}function Wt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=wi.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Re(e):n===3?new V(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Bt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Bt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=xi.exec(t))?new V(e[1],e[2],e[3],1):(e=vi.exec(t))?new V(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=_i.exec(t))?Bt(e[1],e[2],e[3],e[4]):(e=bi.exec(t))?Bt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ii.exec(t))?Ue(e[1],e[2]/100,e[3]/100,1):(e=Ei.exec(t))?Ue(e[1],e[2]/100,e[3]/100,e[4]):Te.hasOwnProperty(t)?Re(Te[t]):t==="transparent"?new V(NaN,NaN,NaN,0):null}function Re(t){return new V(t>>16&255,t>>8&255,t&255,1)}function Bt(t,e,n,r){return r<=0&&(t=e=n=NaN),new V(t,e,n,r)}function Ai(t){return t instanceof Ft||(t=Wt(t)),t?(t=t.rgb(),new V(t.r,t.g,t.b,t.opacity)):new V}function pe(t,e,n,r){return arguments.length===1?Ai(t):new V(t,e,n,r??1)}function V(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ie(V,pe,cn(Ft,{brighter(t){return t=t==null?Zt:Math.pow(Zt,t),new V(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Rt:Math.pow(Rt,t),new V(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new V(gt(this.r),gt(this.g),gt(this.b),jt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Oe,formatHex:Oe,formatHex8:$i,formatRgb:We,toString:We}));function Oe(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}`}function $i(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}${pt((isNaN(this.opacity)?1:this.opacity)*255)}`}function We(){const t=jt(this.opacity);return`${t===1?"rgb(":"rgba("}${gt(this.r)}, ${gt(this.g)}, ${gt(this.b)}${t===1?")":`, ${t})`}`}function jt(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function gt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function pt(t){return t=gt(t),(t<16?"0":"")+t.toString(16)}function Ue(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new et(t,e,n,r)}function ln(t){if(t instanceof et)return new et(t.h,t.s,t.l,t.opacity);if(t instanceof Ft||(t=Wt(t)),!t)return new et;if(t instanceof et)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,c=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=c<.5?o+i:2-o-i,s*=60):a=c>0&&c<1?0:s,new et(s,a,c,t.opacity)}function Mi(t,e,n,r){return arguments.length===1?ln(t):new et(t,e,n,r??1)}function et(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ie(et,Mi,cn(Ft,{brighter(t){return t=t==null?Zt:Math.pow(Zt,t),new et(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Rt:Math.pow(Rt,t),new et(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new V(ue(t>=240?t-240:t+120,i,r),ue(t,i,r),ue(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new et(Fe(this.h),Xt(this.s),Xt(this.l),jt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=jt(this.opacity);return`${t===1?"hsl(":"hsla("}${Fe(this.h)}, ${Xt(this.s)*100}%, ${Xt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Fe(t){return t=(t||0)%360,t<0?t+360:t}function Xt(t){return Math.max(0,Math.min(1,t||0))}function ue(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const un=t=>()=>t;function Ni(t,e){return function(n){return t+n*e}}function ki(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Ti(t){return(t=+t)==1?hn:function(e,n){return n-e?ki(e,n,t):un(isNaN(e)?n:e)}}function hn(t,e){var n=e-t;return n?Ni(t,n):un(isNaN(t)?e:t)}const He=(function t(e){var n=Ti(e);function r(i,o){var s=n((i=pe(i)).r,(o=pe(o)).r),a=n(i.g,o.g),c=n(i.b,o.b),l=hn(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=c(u),i.opacity=l(u),i+""}}return r.gamma=t,r})(1);function ft(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var ge=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,he=new RegExp(ge.source,"g");function Di(t){return function(){return t}}function Li(t){return function(e){return t(e)+""}}function Ri(t,e){var n=ge.lastIndex=he.lastIndex=0,r,i,o,s=-1,a=[],c=[];for(t=t+"",e=e+"";(r=ge.exec(t))&&(i=he.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,c.push({i:s,x:ft(r,i)})),n=he.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?c[0]?Li(c[0].x):Di(e):(e=c.length,function(l){for(var u=0,g;u<e;++u)a[(g=c[u]).i]=g.x(l);return a.join("")})}var Pe=180/Math.PI,me={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function fn(t,e,n,r,i,o){var s,a,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Pe,skewX:Math.atan(c)*Pe,scaleX:s,scaleY:a}}var Yt;function Oi(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?me:fn(e.a,e.b,e.c,e.d,e.e,e.f)}function Wi(t){return t==null||(Yt||(Yt=document.createElementNS("http://www.w3.org/2000/svg","g")),Yt.setAttribute("transform",t),!(t=Yt.transform.baseVal.consolidate()))?me:(t=t.matrix,fn(t.a,t.b,t.c,t.d,t.e,t.f))}function dn(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function o(l,u,g,p,w,k){if(l!==g||u!==p){var D=w.push("translate(",null,e,null,n);k.push({i:D-4,x:ft(l,g)},{i:D-2,x:ft(u,p)})}else(g||p)&&w.push("translate("+g+e+p+n)}function s(l,u,g,p){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),p.push({i:g.push(i(g)+"rotate(",null,r)-2,x:ft(l,u)})):u&&g.push(i(g)+"rotate("+u+r)}function a(l,u,g,p){l!==u?p.push({i:g.push(i(g)+"skewX(",null,r)-2,x:ft(l,u)}):u&&g.push(i(g)+"skewX("+u+r)}function c(l,u,g,p,w,k){if(l!==g||u!==p){var D=w.push(i(w)+"scale(",null,",",null,")");k.push({i:D-4,x:ft(l,g)},{i:D-2,x:ft(u,p)})}else(g!==1||p!==1)&&w.push(i(w)+"scale("+g+","+p+")")}return function(l,u){var g=[],p=[];return l=t(l),u=t(u),o(l.translateX,l.translateY,u.translateX,u.translateY,g,p),s(l.rotate,u.rotate,g,p),a(l.skewX,u.skewX,g,p),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,g,p),l=u=null,function(w){for(var k=-1,D=p.length,z;++k<D;)g[(z=p[k]).i]=z.x(w);return g.join("")}}}var Ui=dn(Oi,"px, ","px)","deg)"),Fi=dn(Wi,", ",")",")"),Ct=0,kt=0,Nt=0,pn=1e3,te,Tt,ee=0,mt=0,ie=0,Ut=typeof performance=="object"&&performance.now?performance:Date,gn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ee(){return mt||(gn(Hi),mt=Ut.now()+ie)}function Hi(){mt=0}function ne(){this._call=this._time=this._next=null}ne.prototype=mn.prototype={constructor:ne,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Ee():+n)+(e==null?0:+e),!this._next&&Tt!==this&&(Tt?Tt._next=this:te=this,Tt=this),this._call=t,this._time=n,ye()},stop:function(){this._call&&(this._call=null,this._time=1/0,ye())}};function mn(t,e,n){var r=new ne;return r.restart(t,e,n),r}function Pi(){Ee(),++Ct;for(var t=te,e;t;)(e=mt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ct}function ze(){mt=(ee=Ut.now())+ie,Ct=kt=0;try{Pi()}finally{Ct=0,qi(),mt=0}}function zi(){var t=Ut.now(),e=t-ee;e>pn&&(ie-=e,ee=t)}function qi(){for(var t,e=te,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:te=n);Tt=t,ye(r)}function ye(t){if(!Ct){kt&&(kt=clearTimeout(kt));var e=t-mt;e>24?(t<1/0&&(kt=setTimeout(ze,t-Ut.now()-ie)),Nt&&(Nt=clearInterval(Nt))):(Nt||(ee=Ut.now(),Nt=setInterval(zi,pn)),Ct=1,gn(ze))}}function qe(t,e,n){var r=new ne;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Bi=be("start","end","cancel","interrupt"),Xi=[],yn=0,Be=1,we=2,Kt=3,Xe=4,xe=5,Jt=6;function oe(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Yi(t,n,{name:e,index:r,group:i,on:Bi,tween:Xi,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:yn})}function Se(t,e){var n=nt(t,e);if(n.state>yn)throw new Error("too late; already scheduled");return n}function ot(t,e){var n=nt(t,e);if(n.state>Kt)throw new Error("too late; already running");return n}function nt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Yi(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=mn(o,0,n.time);function o(l){n.state=Be,n.timer.restart(s,n.delay,n.time),n.delay<=l&&s(l-n.delay)}function s(l){var u,g,p,w;if(n.state!==Be)return c();for(u in r)if(w=r[u],w.name===n.name){if(w.state===Kt)return qe(s);w.state===Xe?(w.state=Jt,w.timer.stop(),w.on.call("interrupt",t,t.__data__,w.index,w.group),delete r[u]):+u<e&&(w.state=Jt,w.timer.stop(),w.on.call("cancel",t,t.__data__,w.index,w.group),delete r[u])}if(qe(function(){n.state===Kt&&(n.state=Xe,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=we,n.on.call("start",t,t.__data__,n.index,n.group),n.state===we){for(n.state=Kt,i=new Array(p=n.tween.length),u=0,g=-1;u<p;++u)(w=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++g]=w);i.length=g+1}}function a(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=xe,1),g=-1,p=i.length;++g<p;)i[g].call(t,u);n.state===xe&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Jt,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function Vi(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>we&&r.state<xe,r.state=Jt,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function Gi(t){return this.each(function(){Vi(this,t)})}function Ki(t,e){var n,r;return function(){var i=ot(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function Ji(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=ot(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}o.tween=i}}function Qi(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=nt(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?Ki:Ji)(n,t,e))}function Ce(t,e,n){var r=t._id;return t.each(function(){var i=ot(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return nt(i,r).value[e]}}function wn(t,e){var n;return(typeof e=="number"?ft:e instanceof Wt?He:(n=Wt(e))?(e=n,He):Ri)(t,e)}function Zi(t){return function(){this.removeAttribute(t)}}function ji(t){return function(){this.removeAttributeNS(t.space,t.local)}}function to(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function eo(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function no(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function ro(t,e,n){var r,i,o;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=a+"",s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a)))}}function io(t,e){var n=re(t),r=n==="transform"?Fi:wn;return this.attrTween(t,typeof e=="function"?(n.local?ro:no)(n,r,Ce(this,"attr."+t,e)):e==null?(n.local?ji:Zi)(n):(n.local?eo:to)(n,r,e))}function oo(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function so(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ao(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&so(t,o)),n}return i._value=e,i}function co(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&oo(t,o)),n}return i._value=e,i}function lo(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=re(t);return this.tween(n,(r.local?ao:co)(r,e))}function uo(t,e){return function(){Se(this,t).delay=+e.apply(this,arguments)}}function ho(t,e){return e=+e,function(){Se(this,t).delay=e}}function fo(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?uo:ho)(e,t)):nt(this.node(),e).delay}function po(t,e){return function(){ot(this,t).duration=+e.apply(this,arguments)}}function go(t,e){return e=+e,function(){ot(this,t).duration=e}}function mo(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?po:go)(e,t)):nt(this.node(),e).duration}function yo(t,e){if(typeof e!="function")throw new Error;return function(){ot(this,t).ease=e}}function wo(t){var e=this._id;return arguments.length?this.each(yo(e,t)):nt(this.node(),e).ease}function xo(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ot(this,t).ease=n}}function vo(t){if(typeof t!="function")throw new Error;return this.each(xo(this._id,t))}function _o(t){typeof t!="function"&&(t=Qe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],c,l=0;l<s;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&a.push(c);return new lt(r,this._parents,this._name,this._id)}function bo(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var c=e[a],l=n[a],u=c.length,g=s[a]=new Array(u),p,w=0;w<u;++w)(p=c[w]||l[w])&&(g[w]=p);for(;a<r;++a)s[a]=e[a];return new lt(s,this._parents,this._name,this._id)}function Io(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Eo(t,e,n){var r,i,o=Io(e)?Se:ot;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function So(t,e){var n=this._id;return arguments.length<2?nt(this.node(),n).on.on(t):this.each(Eo(n,t,e))}function Co(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Ao(){return this.on("end.remove",Co(this._id))}function $o(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ve(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],c=a.length,l=o[s]=new Array(c),u,g,p=0;p<c;++p)(u=a[p])&&(g=t.call(u,u.__data__,p,a))&&("__data__"in u&&(g.__data__=u.__data__),l[p]=g,oe(l[p],e,n,p,l,nt(u,n)));return new lt(o,this._parents,e,n)}function Mo(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Je(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var c=r[a],l=c.length,u,g=0;g<l;++g)if(u=c[g]){for(var p=t.call(u,u.__data__,g,c),w,k=nt(u,n),D=0,z=p.length;D<z;++D)(w=p[D])&&oe(w,e,n,D,p,k);o.push(p),s.push(u)}return new lt(o,s,e,n)}var No=At.prototype.constructor;function ko(){return new No(this._groups,this._parents)}function To(t,e){var n,r,i;return function(){var o=St(this,t),s=(this.style.removeProperty(t),St(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function xn(t){return function(){this.style.removeProperty(t)}}function Do(t,e,n){var r,i=n+"",o;return function(){var s=St(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function Lo(t,e,n){var r,i,o;return function(){var s=St(this,t),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(t),St(this,t))),s===c?null:s===r&&c===i?o:(i=c,o=e(r=s,a))}}function Ro(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var c=ot(this,t),l=c.on,u=c.value[o]==null?a||(a=xn(e)):void 0;(l!==n||i!==u)&&(r=(n=l).copy()).on(s,i=u),c.on=r}}function Oo(t,e,n){var r=(t+="")=="transform"?Ui:wn;return e==null?this.styleTween(t,To(t,r)).on("end.style."+t,xn(t)):typeof e=="function"?this.styleTween(t,Lo(t,r,Ce(this,"style."+t,e))).each(Ro(this._id,t)):this.styleTween(t,Do(t,r,e),n).on("end.style."+t,null)}function Wo(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Uo(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&Wo(t,s,n)),r}return o._value=e,o}function Fo(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Uo(t,e,n??""))}function Ho(t){return function(){this.textContent=t}}function Po(t){return function(){var e=t(this);this.textContent=e??""}}function zo(t){return this.tween("text",typeof t=="function"?Po(Ce(this,"text",t)):Ho(t==null?"":t+""))}function qo(t){return function(e){this.textContent=t.call(this,e)}}function Bo(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&qo(i)),e}return r._value=t,r}function Xo(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Bo(t))}function Yo(){for(var t=this._name,e=this._id,n=_n(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)if(c=s[l]){var u=nt(c,e);oe(c,t,n,l,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new lt(r,this._parents,t,n)}function Vo(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},c={value:function(){--i===0&&o()}};n.each(function(){var l=ot(this,r),u=l.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&o()})}var Go=0;function lt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function vn(t){return At().transition(t)}function _n(){return++Go}var ct=At.prototype;lt.prototype=vn.prototype={constructor:lt,select:$o,selectAll:Mo,selectChild:ct.selectChild,selectChildren:ct.selectChildren,filter:_o,merge:bo,selection:ko,transition:Yo,call:ct.call,nodes:ct.nodes,node:ct.node,size:ct.size,empty:ct.empty,each:ct.each,on:So,attr:io,attrTween:lo,style:Oo,styleTween:Fo,text:zo,textTween:Xo,remove:Ao,tween:Qi,delay:fo,duration:mo,ease:wo,easeVarying:vo,end:Vo,[Symbol.iterator]:ct[Symbol.iterator]};function Ko(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Jo={time:null,delay:0,duration:250,ease:Ko};function Qo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Zo(t){var e,n;t instanceof lt?(e=t._id,t=t._name):(e=_n(),(n=Jo).time=Ee(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,c,l=0;l<a;++l)(c=s[l])&&oe(c,t,e,l,s,n||Qo(c,e));return new lt(r,this._parents,t,e)}At.prototype.interrupt=Gi;At.prototype.transition=Zo;function Dt(t,e,n){this.k=t,this.x=e,this.y=n}Dt.prototype={constructor:Dt,scale:function(t){return t===1?this:new Dt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Dt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Dt.prototype;const _t={margin:{top:48,right:16,bottom:32,left:180},padding:{row:8,col:15},colors:{pos:"#04b254",neg:"#6b3b1f",headerBg:"#2f64b7",headerFg:"#ffffff",grid:"#d6dceb"},fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, sans-serif",showWADD:!1};class bn{constructor(e,n){this.factors=[],this.options=[],this.scores={},this.dragInfo={},this.updatePending=!1,this.editingId=null,this.cfg={...n,..._t,margin:{..._t.margin,...n.margin||{}},padding:{..._t.padding,...n.padding||{}},colors:{..._t.colors,...n.colors||{}},fontFamily:n.fontFamily||_t.fontFamily,showWADD:n.showWADD??_t.showWADD},this.onUpdate=n.onUpdate,this.svg=tt(e).append("svg").style("font-family",this.cfg.fontFamily),this.gCols=this.svg.append("g").attr("class","dl-cols"),this.gRows=this.svg.append("g").attr("class","dl-rows"),this.gGrid=this.svg.append("g").attr("class","dl-grid"),this.gWADD=this.svg.append("g").attr("class","dl-wadd"),this.gControls=this.svg.append("g").attr("class","dl-controls")}setSize(e,n){return this.cfg.width=e,this.cfg.height=n,this.svg.attr("width",e).attr("height",n),this}setShowWADD(e){return this.cfg.showWADD=e,this}data(e){return this.factors=e.factors,this.options=e.options,this.scores=e.scores,this}updateScore(e,n,r){const i=Math.max(-1,Math.min(1,r));return this.scores[e]||(this.scores[e]={}),this.scores[e][n]=i,this}calculateWADDScores(){const e={};return this.options.forEach(n=>{let r=0,i=0;const o=Math.max(0,n.weight);this.factors.forEach(c=>{const l=Math.max(0,c.weight);if(!l||!o)return;const u=this.scores[c.id]?.[n.id]??0,p=(Math.max(-1,Math.min(1,u))+1)/2,w=l*o;r+=w*p,i+=w});const a=(i?r/i:0)*10;e[n.id]=Number(a.toFixed(2))}),e}render(){const{width:e,height:n,margin:r,colors:i,padding:o,onUpdate:s,showWADD:a}=this.cfg,c=Math.max(2,o.row),l=Math.max(2,o.col),u=5,g=44,p=36,w=8,k=a?36:0,D=Math.max(80,e-r.left-r.right-g-w),z=Math.max(80,n-r.top-r.bottom-p-w-k),ut=28,Y=this.factors.map(h=>Math.max(0,h.weight)),G=Math.max(1e-6,Ne(Y)),f=ut*this.factors.length,$=Math.max(0,z-f),T=f>z?z/f:1;let S=this.factors.map((h,d)=>(ut+$*(Y[d]/G))*T);const q=S.reduce((h,d)=>h+d,0);if(q>z){const h=z/q;S=S.map(d=>d*h)}const O=[r.top];for(let h=1;h<S.length;h++)O[h]=O[h-1]+S[h-1];const Z=120,B=this.options.map(h=>Math.max(0,h.weight)),yt=Math.max(1e-6,Ne(B)),st=Z*this.options.length,J=Math.max(0,D-st),P=st>D?D/st:1;let L=this.options.map((h,d)=>(Z+J*(B[d]/yt))*P).map(h=>h+l);const xt=L.reduce((h,d)=>h+d,0);if(xt>D){const h=D/xt;L=L.map(d=>d*h)}const m=[r.left];for(let h=1;h<L.length;h++)m[h]=m[h-1]+L[h-1];this.svg.attr("width",e).attr("height",n);const _=36,I=this.gCols.selectAll("g.col").data(this.options,h=>h.id),y=I.enter().append("g").attr("class","col");y.append("rect").attr("class","header-bg").attr("rx",6).attr("ry",6),y.append("text").attr("class","header-text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-weight",700).style("fill",i.headerFg),y.append("foreignObject").attr("class","header-input"),y.append("rect").attr("class","resize-handle").style("cursor","col-resize").attr("fill","transparent"),y.append("text").attr("class","remove-btn").style("cursor","pointer").style("fill",i.headerFg).text("Ã—");const C=y.merge(I),v=vn().duration(150);C.transition(v).attr("transform",(h,d)=>`translate(${m[d]}, ${r.top-_})`),C.select("rect.header-bg").transition(v).attr("x",l/2).attr("y",-2).attr("width",(h,d)=>L[d]-l).attr("height",_).attr("fill",i.headerBg),C.select("text.header-text").text(h=>h.label).style("pointer-events","auto").on("dblclick",(h,d)=>{this.editingId||(this.editingId=d.id,this.render())}).transition(v).attr("x",(h,d)=>L[d]/2-10).attr("y",_/2);const A=C.select("foreignObject.header-input").style("display",h=>this.editingId===h.id?"block":"none").html(h=>`
        <input type="text" value="${h.label}" style="width:100%; height:100%; background:#1a2a5e; color:#fff; border:1px solid #3f51b5; border-radius:4px; padding:0 4px;" />
      `);A.transition(v).attr("x",l/2+10).attr("y",-2).attr("width",(h,d)=>L[d]-l-20).attr("height",_),A.on("blur",(h,d)=>{const b=h.target.querySelector("input").value.trim()||d.label;this.options=this.options.map(x=>x.id===d.id?{...x,label:b}:x),this.editingId=null,this.render(),this.onUpdate&&this.onUpdate({options:[...this.options]})}).select("input").on("keypress",(h,d)=>{if(h.key==="Enter"){const b=h.target.value.trim()||d.label;this.options=this.options.map(x=>x.id===d.id?{...x,label:b}:x),this.editingId=null,this.render(),this.onUpdate&&this.onUpdate({options:[...this.options]})}}),C.select("rect.resize-handle").transition(v).attr("x",(h,d)=>L[d]-l/2-8).attr("y",-2).attr("width",16).attr("height",_),C.select("text.remove-btn").attr("x",(h,d)=>L[d]-l/2-20).attr("y",_/2).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").on("click",(h,d)=>{this.options=this.options.filter(b=>b.id!==d.id);const E={};Object.keys(this.scores).forEach(b=>{E[b]={},Object.keys(this.scores[b]).forEach(x=>{this.options.some(M=>M.id===x)&&(E[b][x]=this.scores[b][x])})}),this.scores=E,this.render(),this.onUpdate&&this.onUpdate({options:[...this.options],scores:{...this.scores}})}),C.select("rect.resize-handle").call(Mt().on("start",(h,d)=>{const E=this.options.findIndex(b=>b.id===d.id);this.dragInfo={type:"col-resize",startX:h.x,startWidth:L[E],startWeight:d.weight,idx:E,updating:!1}}).on("drag",(h,d)=>{const E=h.x-this.dragInfo.startX;let b=Math.max(50,this.dragInfo.startWidth+E),x=this.dragInfo.startWeight*(b/this.dragInfo.startWidth);x=Math.max(1,Math.min(2,x)),this.options[this.dragInfo.idx].weight=x,this.updatePending||(this.updatePending=!0,requestAnimationFrame(()=>{this.render(),this.onUpdate&&this.onUpdate({options:[...this.options]}),this.updatePending=!1}))}).on("end",()=>{this.onUpdate&&this.onUpdate({options:[...this.options]})})),C.select("rect.header-bg").style("cursor","move").call(Mt().on("start",(h,d)=>{tt(h.sourceEvent.target.parentNode).raise();const b=this.options.findIndex(x=>x.id===d.id);this.dragInfo={type:"col-reorder",startX:h.x,idx:b,origLeft:m[b],newIdx:b}}).on("drag",h=>{const d=tt(h.sourceEvent.target.parentNode),E=this.dragInfo.origLeft+h.x-this.dragInfo.startX;d.attr("transform",`translate(${E}, ${r.top-_})`);const b=E+L[this.dragInfo.idx]/2;let x=0;for(let M=0;M<m.length;M++){if(M===this.dragInfo.idx)continue;const W=m[M]+L[M]/2;b>W&&(x=M+1)}x>this.dragInfo.idx&&x--,x!==this.dragInfo.newIdx&&(this.dragInfo.newIdx=x,this.gCols.selectAll("g.col").filter((M,W)=>W!==this.dragInfo.idx).transition().duration(150).attr("transform",(M,W)=>{let Q=m[W];return W>this.dragInfo.idx&&W<=x?Q-=L[this.dragInfo.idx]:W<this.dragInfo.idx&&W>=x&&(Q+=L[this.dragInfo.idx]),`translate(${Q}, ${r.top-_})`}))}).on("end",()=>{const h=this.dragInfo.newIdx,d=this.options.splice(this.dragInfo.idx,1)[0];this.options.splice(h,0,d),this.render(),this.onUpdate&&this.onUpdate({options:[...this.options]})})),I.exit().remove();const U=this.gRows.selectAll("g.row").data(this.factors,h=>h.id),F=U.enter().append("g").attr("class","row");F.append("rect").attr("class","row-bg").attr("rx",6).attr("ry",6),F.append("text").attr("class","row-text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-weight",600).style("fill",i.headerFg),F.append("foreignObject").attr("class","row-input"),F.append("rect").attr("class","resize-handle").style("cursor","row-resize").attr("fill","transparent"),F.append("text").attr("class","remove-btn").style("cursor","pointer").style("fill",i.headerFg).text("Ã—");const R=F.merge(U);R.transition(v).attr("transform",(h,d)=>`translate(0, ${O[d]})`),R.select("rect.row-bg").transition(v).attr("x",0).attr("width",r.left-5).attr("y",c/2).attr("height",(h,d)=>S[d]-c).attr("fill",i.headerBg).style("cursor","move"),R.select("text.row-text").attr("x",r.left/2-10).attr("y",(h,d)=>S[d]/2).text(h=>h.label).style("pointer-events","auto").on("dblclick",(h,d)=>{this.editingId||(this.editingId=d.id,this.render())}),R.select("foreignObject.row-input").attr("x",10).attr("y",c/2).attr("width",r.left-25).attr("height",(h,d)=>S[d]-c).style("display",h=>this.editingId===h.id?"block":"none").html(h=>`
        <input type="text" value="${h.label}" style="width:100%; height:100%; background:#1a2a5e; color:#fff; border:1px solid #3f51b5; border-radius:4px; padding:0 4px;" />
      `).on("blur",(h,d)=>{const b=h.target.querySelector("input").value.trim()||d.label;this.factors=this.factors.map(x=>x.id===d.id?{...x,label:b}:x),this.editingId=null,this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors]})}).select("input").on("keypress",(h,d)=>{if(h.key==="Enter"){const b=h.target.value.trim()||d.label;this.factors=this.factors.map(x=>x.id===d.id?{...x,label:b}:x),this.editingId=null,this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors]})}}),R.select("rect.resize-handle").attr("x",0).attr("width",r.left-5).attr("y",(h,d)=>S[d]-8).attr("height",16),R.select("text.remove-btn").attr("x",r.left-15).attr("y",(h,d)=>S[d]/2).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").on("click",(h,d)=>{this.factors=this.factors.filter(b=>b.id!==d.id);const E={};this.factors.forEach(b=>{E[b.id]={...this.scores[b.id]}}),this.scores=E,this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors],scores:{...this.scores}})}),R.select("rect.resize-handle").call(Mt().on("start",(h,d)=>{const E=this.factors.findIndex(b=>b.id===d.id);this.dragInfo={type:"row-resize",startY:h.y,startHeight:S[E],startWeight:d.weight,idx:E,updating:!1}}).on("drag",(h,d)=>{const E=h.y-this.dragInfo.startY;let b=Math.max(10,this.dragInfo.startHeight+E),x=this.dragInfo.startWeight*(b/this.dragInfo.startHeight);x=Math.max(1,Math.min(2,x)),this.factors[this.dragInfo.idx].weight=x,this.updatePending||(this.updatePending=!0,requestAnimationFrame(()=>{this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors]}),this.updatePending=!1}))}).on("end",()=>{this.onUpdate&&this.onUpdate({factors:[...this.factors]})})),R.select("rect.row-bg").call(Mt().on("start",(h,d)=>{tt(h.sourceEvent.target.parentNode).raise();const b=this.factors.findIndex(x=>x.id===d.id);this.dragInfo={type:"row-reorder",startY:h.y,idx:b,origTop:O[b],newIdx:b}}).on("drag",h=>{const d=tt(h.sourceEvent.target.parentNode),E=this.dragInfo.origTop+h.y-this.dragInfo.startY;d.attr("transform",`translate(0, ${E})`);const b=E+S[this.dragInfo.idx]/2;let x=0;for(let M=0;M<O.length;M++){if(M===this.dragInfo.idx)continue;const W=O[M]+S[M]/2;b>W&&(x=M+1)}x>this.dragInfo.idx&&x--,x!==this.dragInfo.newIdx&&(this.dragInfo.newIdx=x,this.gRows.selectAll("g.row").filter((M,W)=>W!==this.dragInfo.idx).transition().duration(150).attr("transform",(M,W)=>{let Q=O[W];return W>this.dragInfo.idx&&W<=x?Q-=S[this.dragInfo.idx]:W<this.dragInfo.idx&&W>=x&&(Q+=S[this.dragInfo.idx]),`translate(0, ${Q})`}))}).on("end",()=>{const h=this.dragInfo.newIdx,d=this.factors.splice(this.dragInfo.idx,1)[0];this.factors.splice(h,0,d),this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors]})})),U.exit().remove();const j=this.factors.flatMap((h,d)=>this.options.map((E,b)=>({ridx:d,cidx:b,fid:h.id,oid:E.id,score:this.scores[h.id]?.[E.id]??0}))),at=this.gGrid.selectAll("g.cell").data(j,h=>`${h.fid}__${h.oid}`),X=at.enter().append("g").attr("class","cell");X.append("rect").attr("class","cell-bg").attr("fill",i.grid).attr("rx",6).attr("ry",6),X.append("rect").attr("class","cell-pos").attr("fill",i.pos),X.append("rect").attr("class","cell-neg").attr("fill",i.neg),X.append("rect").attr("class","score-handle").style("cursor","col-resize").attr("fill","transparent");const H=X.merge(at);H.transition(v).attr("transform",h=>`translate(${m[h.cidx]}, ${O[h.ridx]})`),H.select("rect.cell-bg").transition(v).attr("x",l/2).attr("y",c/2).attr("width",h=>L[h.cidx]-l).attr("height",h=>S[h.ridx]-c),H.each(function(h){const d=tt(this),E=S[h.ridx]-c,b=c/2,x=L[h.cidx]-l,M=l/2,W=(h.score+1)/2,Q=x*W,Sn=x-Q;d.select("rect.cell-pos").transition(v).attr("x",M+1).attr("y",b+1).attr("width",Math.max(0,Q-1)).attr("height",Math.max(0,E-2)),d.select("rect.cell-neg").transition(v).attr("x",M+Q+1).attr("y",b+1).attr("width",Math.max(0,Sn-2)).attr("height",Math.max(0,E-2)),d.select("rect.score-handle").transition(v).attr("x",M+Q-2.5).attr("y",b+1).attr("width",5).attr("height",Math.max(0,E-2))}),H.select("rect.score-handle").call(Mt().on("start",(h,d)=>{const E=tt(h.sourceEvent.target.parentNode),b=L[d.cidx]-l,x=(d.score+1)/2,M=b*x;this.dragInfo={type:"cell-score",startX:h.x,startWPos:M,w:b,d,g:E}}).on("drag",h=>{const d=h.x-this.dragInfo.startX;let E=Math.max(0,Math.min(this.dragInfo.w,this.dragInfo.startWPos+d));this.dragInfo.g.select("rect.cell-pos").attr("width",E-1),this.dragInfo.g.select("rect.cell-neg").attr("x",l/2+E+1).attr("width",this.dragInfo.w-E-2),this.dragInfo.g.select("rect.score-handle").attr("x",l/2+E-2.5);const b=2*(E/this.dragInfo.w)-1;if(this.updateScore(this.dragInfo.d.fid,this.dragInfo.d.oid,b),a){const x=this.calculateWADDScores();this.gWADD.selectAll("g.wadd").select("text").text(M=>`WADD: ${x[M.id].toFixed(1)}/10`)}}).on("end",()=>{const d=2*((Number(this.dragInfo.g.select("rect.cell-pos").attr("width"))+1)/this.dragInfo.w)-1;this.updateScore(this.dragInfo.d.fid,this.dragInfo.d.oid,d),this.onUpdate&&this.onUpdate({scores:{...this.scores}}),this.render()})),at.exit().remove();const rt=S.reduce((h,d)=>h+d,0),Pt=r.top+rt+(rt>0?w:0);if(a){const h=this.calculateWADDScores(),d=this.gWADD.selectAll("g.wadd").data(this.options,x=>x.id),E=d.enter().append("g").attr("class","wadd");E.append("rect").attr("class","wadd-bg").attr("rx",6).attr("ry",6),E.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-weight",600).style("fill",i.headerFg);const b=E.merge(d);b.transition(v).attr("transform",(x,M)=>`translate(${m[M]}, ${Pt})`),b.select("rect.wadd-bg").transition(v).attr("x",l/2).attr("y",2).attr("width",(x,M)=>L[M]-l).attr("height",36).attr("fill",i.headerBg),b.select("text").transition(v).attr("x",(x,M)=>L[M]/2).attr("y",20).text(x=>`WADD: ${h[x.id].toFixed(1)}/10`),d.exit().remove()}else this.gWADD.selectAll("*").remove();const dt=this.gControls.selectAll("g.control").data(this.options.length<u?["add-option"]:[],h=>h),$t=dt.enter().append("g").attr("class","control");$t.append("rect").attr("fill",i.headerBg).attr("rx",6).attr("ry",6).style("cursor","pointer"),$t.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("fill",i.headerFg).style("font-weight",600).style("cursor","pointer").text("+");const vt=$t.merge(dt);vt.attr("transform",()=>`translate(${e-r.right-g}, ${r.top-_})`),vt.select("rect").attr("x",0).attr("y",0).attr("width",g).attr("height",p),vt.select("text").attr("x",g/2).attr("y",p/2),vt.on("click",()=>{if(this.options.length>=u)return;const h=`o${Date.now()}`;this.options.push({id:h,label:`Option ${this.options.length+1}`,weight:1.5}),this.scores={...this.scores},this.factors.forEach(d=>{this.scores[d.id]={...this.scores[d.id],[h]:0}}),this.render(),this.onUpdate&&this.onUpdate({options:[...this.options],scores:{...this.scores}})}),dt.exit().remove();const ae=this.gControls.selectAll("g.factor-control").data(this.factors.length<u?["add-factor"]:[],h=>h),ce=ae.enter().append("g").attr("class","factor-control");ce.append("rect").attr("fill",i.headerBg).attr("rx",6).attr("ry",6).style("cursor","pointer"),ce.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").style("fill",i.headerFg).style("font-weight",600).style("cursor","pointer").text("+");const zt=ce.merge(ae),In=Pt+(a?k+w:w),En=Math.min(In,n-r.bottom-p);return zt.attr("transform",()=>`translate(0, ${En})`),zt.select("rect").attr("x",0).attr("width",Math.max(60,r.left-5)).attr("y",0).attr("height",p),zt.select("text").attr("x",Math.max(60,r.left-5)/2).attr("y",p/2),zt.on("click",()=>{if(this.factors.length>=u)return;const h=`f${Date.now()}`;this.factors.push({id:h,label:`Factor ${this.factors.length+1}`,weight:1.5}),this.scores[h]={},this.options.forEach(d=>{this.scores[h][d.id]=0}),this.render(),this.onUpdate&&this.onUpdate({factors:[...this.factors],scores:{...this.scores}})}),ae.exit().remove(),this}}const jo="decision-layout:builder-state",ts=(()=>{if(typeof window>"u")return!1;try{return window.self!==window.top}catch{return!0}})();function es(t){if(typeof window>"u")return;const e=JSON.stringify(t);try{window.localStorage.setItem(jo,e)}catch(n){console.warn("Unable to persist builder state to localStorage",n)}if(ts&&window.parent)try{const n=JSON.parse(e);window.parent.postMessage({type:"decision-layout:update",payload:n},"*")}catch(n){console.warn("Unable to post builder state to parent frame",n)}}const Ye=5,Ve=t=>(t-3)/2,Vt=t=>1+(t-1)/4,ht=t=>Math.round(1+(t-1)*4),ns=t=>Math.round(3+t*2);function se(t){return e=>{const n=t.kind==="chart"?`
        <div style="margin-bottom:12px">
          <label style="display:flex; align-items:center; gap:8px; color:var(--fg)">
            <input type="checkbox" id="showWADD"> Show WADD Scores
          </label>
        </div>
      `:"";e.innerHTML=`
      <section class="card">
        <h1 class="h1">Build your decision layout</h1>
        <ol style="margin:0 0 12px 1.1rem; color:var(--muted)">
          <li>Add up to 5 choices & set importance</li>
          <li>Add factors and set importance (1â€“5)</li>
          <li>Rate each choice per factor (1â€“5)</li>
        </ol>
        ${n}
        <div id="step"></div>
        <div style="display:flex; gap:.5rem; margin-top:12px">
          <button id="backBtn" style="display:none">Back</button>
          <button id="nextBtn">Next</button>
        </div>
      </section>
      <section id="previewCard" class="card" style="margin-top:12px">
        <h2 class="h1" style="font-size:1.2rem">Preview</h2>
        <div id="viz" style="margin-top:8px; background:#0f1730; border-radius:12px; padding:8px;"></div>
      </section>
    `;const r=e.querySelector("#step"),i=e.querySelector("#backBtn"),o=e.querySelector("#nextBtn"),s=e.querySelector("#viz");s.style.overflow=t.kind==="chart"?"hidden":"auto";const a=t.kind==="chart"?e.querySelector("#showWADD"):null,c=e.querySelector("#previewCard");let l=!1,u=t.previewMode!=="after-finish";const g=600,p=()=>Math.max(360,s.clientWidth||e.clientWidth||960);let w=null,k=null;const D=()=>{w&&w.setSize(p(),g)};t.kind==="chart"&&(w=new bn(s,{width:p(),height:g,showWADD:l,onUpdate:m=>{var _;if(m.factors){const I=new Map(f.factors.map(y=>[y.id,y]));m.factors.forEach(y=>{const C=I.get(y.id);C?(C.label=y.label,C.uiImportance=ht(y.weight)):f.factors.push({id:y.id,label:y.label,uiImportance:ht(y.weight)})}),f.factors=m.factors.map(y=>I.get(y.id)||{id:y.id,label:y.label,uiImportance:ht(y.weight)})}if(m.options){const I=new Map(f.options.map(y=>[y.id,y]));m.options.forEach(y=>{const C=I.get(y.id);C?(C.label=y.label,C.uiImportance=ht(y.weight)):f.options.push({id:y.id,label:y.label,uiImportance:ht(y.weight)})}),f.options=m.options.map(y=>I.get(y.id)||{id:y.id,label:y.label,uiImportance:ht(y.weight)})}if(m.scores)for(const I in m.scores){(_=f.scoresUI)[I]??(_[I]={});for(const y in m.scores[I])f.scoresUI[I][y]=ns(m.scores[I][y])}T(f,f),st(),P()}}),a?.addEventListener("change",()=>{l=!!a.checked,w?.setShowWADD(l),P(!0)}),typeof ResizeObserver<"u"&&(k=new ResizeObserver(()=>{D(),(t.previewMode==="live"||u)&&P(!0)}),k.observe(s))),t.previewMode==="after-finish"&&(c.style.display="none");let z=0,ut=0;const Y=()=>`o${++z}`,G=()=>`f${++ut}`,f={options:[{id:Y(),label:"Option A",uiImportance:3},{id:Y(),label:"Option B",uiImportance:3}],factors:[{id:G(),label:"Factor 1",uiImportance:3},{id:G(),label:"Factor 2",uiImportance:3}],scoresUI:{}},$=m=>JSON.parse(JSON.stringify(m));function T(m,_){const I={},y=m.scoresUI||{};for(const C of _.factors){I[C.id]={};for(const v of _.options){const N=y[C.id]?.[v.id];I[C.id][v.id]=N??3}}_.scoresUI=I}let S=1;function q(){r.innerHTML=`
        <h2 class="h1" style="font-size:1.2rem">Step 1 â€” Add choices (max ${Ye})</h2>
        <div id="choices"></div>
        <div style="margin-top:8px">
          <button id="addChoiceBtn">Add choice</button>
        </div>
        <p style="color:var(--muted); margin-top:8px">You can rename choices and set importance anytime.</p>
      `;const m=r.querySelector("#choices");O(m),r.querySelector("#addChoiceBtn").onclick=()=>{if(f.options.length>=Ye)return;const _=$(f),I=f.options.length+1;f.options.push({id:Y(),label:`Option ${I}`,uiImportance:3}),T(_,f),O(m),P()},i.style.display="none",o.textContent="Next"}function O(m){m.innerHTML="",f.options.forEach((_,I)=>{const y=document.createElement("div");y.style.display="grid",y.style.gridTemplateColumns="80px 1fr 220px 90px",y.style.gap="8px",y.style.margin="6px 0";const C=document.createElement("div");C.textContent=String(I+1);const v=document.createElement("input");v.type="text",v.value=_.label,v.placeholder=`Option ${I+1}`,v.oninput=()=>{_.label=v.value.trim()||`Option ${I+1}`,P()};const N=document.createElement("div"),A=document.createElement("input");A.type="range",A.min="1",A.max="5",A.step="1",A.value=String(_.uiImportance);const U=document.createElement("span");U.style.marginLeft="8px";const F=()=>U.textContent=`Importance: ${A.value} â†’ weight ${Vt(Number(A.value)).toFixed(2)}`;A.oninput=()=>{_.uiImportance=Number(A.value),F(),P()},F(),N.append(A,U);const R=document.createElement("button");R.textContent="Remove",R.onclick=()=>{const j=$(f);f.options.splice(I,1),T(j,f),O(m),P()},y.append(C,v,N,R),m.appendChild(y)})}function Z(){r.innerHTML=`
        <h2 class="h1" style="font-size:1.2rem">Step 2 â€” Add factors</h2>
        <div id="factors"></div>
        <div style="margin-top:8px">
          <button id="addFactorBtn">Add factor</button>
        </div>
        <p style="color:var(--muted); margin-top:8px">Weights scale the bars in the visualization.</p>
      `;const m=r.querySelector("#factors");B(m),r.querySelector("#addFactorBtn").onclick=()=>{const _=$(f),I=f.factors.length+1;f.factors.push({id:G(),label:`Factor ${I}`,uiImportance:3}),T(_,f),B(m),P()},i.style.display="",o.textContent="Next"}function B(m){m.innerHTML="",f.factors.forEach((_,I)=>{const y=document.createElement("div");y.style.display="grid",y.style.gridTemplateColumns="80px 1fr 220px 90px",y.style.gap="8px",y.style.margin="6px 0";const C=document.createElement("div");C.textContent=String(I+1);const v=document.createElement("input");v.type="text",v.value=_.label,v.placeholder=`Factor ${I+1}`,v.oninput=()=>{_.label=v.value.trim()||`Factor ${I+1}`,P()};const N=document.createElement("div"),A=document.createElement("input");A.type="range",A.min="1",A.max="5",A.step="1",A.value=String(_.uiImportance);const U=document.createElement("span");U.style.marginLeft="8px";const F=()=>U.textContent=`Importance: ${A.value} â†’ weight ${Vt(Number(A.value)).toFixed(2)}`;A.oninput=()=>{_.uiImportance=Number(A.value),F(),P()},F(),N.append(A,U);const R=document.createElement("button");R.textContent="Remove",R.onclick=()=>{const j=$(f);f.factors.splice(I,1),T(j,f),B(m),P()},y.append(C,v,N,R),m.appendChild(y)})}function yt(){r.innerHTML=`
        <h2 class="h1" style="font-size:1.2rem">Step 3 â€” Score each factor per option</h2>
        <div style="overflow:auto; max-width:100%">
          <table class="table" style="width:100%; min-width:680px">
            <thead>
              <tr>
                <th scope="col">Factor</th>
                ${f.options.map(_=>`<th scope="col">${_.label}</th>`).join("")}
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      `;const m=r.querySelector("tbody");m.innerHTML="",f.factors.forEach(_=>{const I=document.createElement("tr"),y=document.createElement("th");y.scope="row",y.textContent=_.label,I.appendChild(y),f.options.forEach(C=>{const v=document.createElement("td");v.style.minWidth="140px";const N=document.createElement("input");N.type="range",N.min="1",N.max="5",N.step="1",N.value=String(f.scoresUI[_.id]?.[C.id]??3);const A=document.createElement("span");A.style.marginLeft="6px";const U=()=>A.textContent=`${N.value} â†’ ${Ve(Number(N.value)).toFixed(2)}`;U(),N.oninput=()=>{var F,R;(F=f.scoresUI)[R=_.id]||(F[R]={}),f.scoresUI[_.id][C.id]=Number(N.value),U(),P()},v.append(N,A),I.appendChild(v)}),m.appendChild(I)}),i.style.display="",o.textContent="Finish"}function st(){S===1?q():S===2?Z():yt()}function J(m){S=m,st()}i.onclick=()=>{S===2?J(1):S===3&&J(2)},o.onclick=()=>{if(S===1){if(f.options.length<2){alert("Please add at least 2 choices.");return}const m=$(f);T(m,f),J(2)}else if(S===2){if(f.factors.length<1){alert("Please add at least 1 factor.");return}const m=$(f);T(m,f),J(3)}else u=!0,t.previewMode==="after-finish"&&(c.style.display=""),P(!0)};function P(m=!1){if(t.previewMode==="after-finish"&&!u&&!m)return;const _=t.kind==="chart"?t.previewMode==="live"||!u:!1,I=wt(f,_);es(I),t.kind==="chart"?(D(),w?.data(I).render()):L(I)}function wt(m,_=!1){const I=m.options.map(v=>({id:v.id,label:v.label,weight:Vt(v.uiImportance)})),y=m.factors.map(v=>({id:v.id,label:v.label,weight:Vt(v.uiImportance)})),C={};for(const v of m.factors){C[v.id]={};for(const N of m.options){const A=m.scoresUI[v.id]?.[N.id];C[v.id][N.id]=A?Ve(A):0}}return{options:I,factors:y,scores:C}}function L(m){s.replaceChildren();const _=document.createElement("table");_.className="table",_.style.width="100%",_.style.minWidth="680px";const I=document.createElement("thead"),y=document.createElement("tr");["Factor","Importance",...m.options.map(X=>X.label)].forEach((X,H)=>{const rt=document.createElement("th");rt.scope="col",rt.textContent=X,y.appendChild(rt)}),I.appendChild(y),_.appendChild(I);const v=document.createElement("tbody"),N=document.createElement("tr"),A=document.createElement("th");A.scope="row",A.textContent="Option importance",N.appendChild(A);const U=document.createElement("td");U.textContent="",N.appendChild(U),m.options.forEach(X=>{const H=document.createElement("td");H.style.textAlign="center",H.textContent=String(ht(X.weight)),N.appendChild(H)}),v.appendChild(N),m.factors.forEach(X=>{const H=document.createElement("tr"),rt=document.createElement("th");rt.scope="row",rt.textContent=X.label,H.appendChild(rt);const Ht=document.createElement("td");Ht.style.textAlign="center",Ht.textContent=String(ht(X.weight)),H.appendChild(Ht),m.options.forEach(Pt=>{const dt=document.createElement("td");dt.style.textAlign="center";const $t=m.scores[X.id]?.[Pt.id]??0,vt=(Math.max(-1,Math.min(1,$t))+1)/2;dt.textContent=(vt*10).toFixed(1),H.appendChild(dt)}),v.appendChild(H)});const F=xt(m),R=document.createElement("tr"),j=document.createElement("th");j.scope="row",j.textContent="WADD",R.appendChild(j);const at=document.createElement("td");at.textContent="",R.appendChild(at),m.options.forEach(X=>{const H=document.createElement("td");H.style.textAlign="center",H.textContent=F[X.id].toFixed(1),R.appendChild(H)}),v.appendChild(R),_.appendChild(v),s.appendChild(_)}function xt(m){const _={};return m.options.forEach(I=>{let y=0,C=0;const v=Math.max(0,I.weight);m.factors.forEach(A=>{const U=Math.max(0,A.weight);if(!U||!v)return;const F=m.scores[A.id]?.[I.id]??0,j=(Math.max(-1,Math.min(1,F))+1)/2,at=U*v;y+=at*j,C+=at});const N=C?y/C:0;_[I.id]=N*10}),_}J(1),t.previewMode==="live"&&P(!0)}}const rs=Object.freeze(Object.defineProperty({__proto__:null,createBuilderLayout:se},Symbol.toStringTag,{value:"Module"})),is={name:"manual"},os=t=>{t.innerHTML=`
    <section class="card">
      <h1 class="h1">Direct Manipulation View</h1>
      <p style="color:var(--muted); margin-top:4px">Use the controls embedded in the chart to rename, resize, and rescore options without the step-by-step wizard.</p>
      <div id="manualViz" style="margin-top:12px; background:#0f1730; border-radius:12px; padding:8px;"></div>
    </section>
  `;const e=t.querySelector("#manualViz"),n={options:[{id:"o1",label:"Option A",weight:1.2},{id:"o2",label:"Option B",weight:1},{id:"o3",label:"Option C",weight:.9}],factors:[{id:"f1",label:"Impact",weight:1.2},{id:"f2",label:"Cost",weight:1},{id:"f3",label:"Time",weight:.8}],scores:{f1:{o1:.6,o2:.1,o3:-.2},f2:{o1:-.3,o2:.2,o3:.4},f3:{o1:.5,o2:-.2,o3:.3}}},r=new bn(e,{width:1100,height:600,showWADD:!0,onUpdate:a=>{var c;if(a.options&&i("options",a.options),a.factors&&i("factors",a.factors),a.scores)for(const l in a.scores)(c=n.scores)[l]??(c[l]={}),Object.assign(n.scores[l],a.scores[l]);o(),s()}});function i(a,c){const l=new Map(n[a].map(u=>[u.id,u]));n[a]=c.map(u=>{const g=l.get(u.id);return g?Object.assign(g,u):{...u}})}function o(){const a={};n.factors.forEach(c=>{a[c.id]={},n.options.forEach(l=>{const u=n.scores[c.id]?.[l.id];a[c.id][l.id]=typeof u=="number"?u:0})}),n.scores=a}function s(){r.data({options:n.options.map(a=>({...a})),factors:n.factors.map(a=>({...a})),scores:JSON.parse(JSON.stringify(n.scores))}).render()}o(),s()},ss=Object.freeze(Object.defineProperty({__proto__:null,default:os,meta:is},Symbol.toStringTag,{value:"Module"})),as={name:"table"},cs=se({previewMode:"after-finish",kind:"table"}),ls=Object.freeze(Object.defineProperty({__proto__:null,default:cs,meta:as},Symbol.toStringTag,{value:"Module"})),us={name:"vanilla"},hs=se({previewMode:"live",kind:"chart"}),fs=Object.freeze(Object.defineProperty({__proto__:null,default:hs,meta:us},Symbol.toStringTag,{value:"Module"})),ds={name:"wizard"},ps=se({previewMode:"after-finish",kind:"chart"}),gs=Object.freeze(Object.defineProperty({__proto__:null,default:ps,meta:ds},Symbol.toStringTag,{value:"Module"})),Ge="vanilla",ms=Object.assign({"../vis/layoutBuilderFactory.ts":rs,"../vis/manual.ts":ss,"../vis/table.ts":ls,"../vis/vanilla.ts":fs,"../vis/wizard.ts":gs}),bt=new Map;for(const[t,e]of Object.entries(ms)){const r=(t.split("/").pop()??"").replace(/\.[^.]+$/,""),i=e.meta?.name??r;if(!e.default||!i)continue;const o={name:i,render:e.default},s=new Set([i.toLowerCase(),r.toLowerCase()]);e.meta?.name&&s.add(e.meta.name.toLowerCase());for(const a of s)a&&bt.set(a,o)}const ys=Array.from(new Set(Array.from(bt.values()).map(t=>t.name.toLowerCase()))),ws=(t,e)=>{const n=(e.query.get("layout")||Ge).toLowerCase(),r=bt.get(Ge)??Array.from(bt.values())[0];if(!r){t.innerHTML=`
      <section class="card">
        <h1 class="h1">No Layouts Registered</h1>
        <p>Add a layout file under <code>src/vis</code> to continue.</p>
      </section>
    `;return}const i=bt.get(n)??r,o=i.name.toLowerCase(),s=bt.has(n),a=document.createElement("div");if(a.className="layout-host",t.replaceChildren(),!s){const c=ys.map(u=>`<code>${u}</code>`).join(", "),l=document.createElement("section");l.className="card",l.style.marginBottom="12px",l.innerHTML=`
      <h1 class="h1" style="font-size:1.1rem">Unknown Layout</h1>
      <p>Request <code>${n}</code> not found. Showing <code>${o}</code>.</p>
      <p>Available layouts: ${c||"none"}.</p>
    `,t.appendChild(l)}return t.dataset.layout=o,t.appendChild(a),i.render(a,e)},xs=t=>{t.innerHTML=`
    <section class="card">
      <h1 class="h1">About</h1>
      <p>Framework-free, TypeScript-first, D3-powered decision visualization.</p>
    </section>`},vs=[{path:"/",title:"Home â€¢ Decision Layout",render:Ae},{path:"",title:"Home â€¢ Decision Layout",render:Ae},{path:"/builder",title:"Builder â€¢ Decision Layout",render:ws},{path:"/about",title:"About â€¢ Decision Layout",render:xs}];new $n({routes:vs,outlet:document.getElementById("app")});
